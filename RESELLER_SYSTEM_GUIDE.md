# Reseller System Implementation Guide

## üéâ Overview

The Livekenceng application now includes a complete **Reseller Management System** with pricing controls and balance management. This guide explains all the new features and how to use them.

## ‚ú® New Features Added

### 1. **Reseller User Type**
- Resellers are separate from admins and members
- Each reseller has their own login portal at `/reseller/login`
- Resellers can generate license keys and view their transaction history

### 2. **Balance System**
- Each reseller has a balance in their account
- Balance is deducted when generating license keys
- Admins can add balance to reseller accounts

### 3. **Discount System**
- Each reseller has a custom discount percentage (0-100%)
- Final price = Base Price √ó (100 - Discount%) / 100
- Example: 40k license with 10% discount = 36k

### 4. **License Pricing**
- Admins can set base prices for each license duration
- Prices are configurable through the admin dashboard
- Default prices:
  - 1 Day: Rp 10,000
  - 3 Days: Rp 25,000
  - 7 Days: Rp 40,000
  - 14 Days: Rp 70,000
  - 30 Days: Rp 139,000

### 5. **License Tracking**
- Each license key tracks which reseller generated it
- Resellers can only see their own licenses
- Shows usage status and which member redeemed it

## üóÑÔ∏è Database Changes

### New Tables

#### `resellers` Table
```sql
- id (primary key)
- name (string)
- email (unique)
- password (hashed)
- balance (decimal 10,2)
- discount_percentage (decimal 5,2)
- created_at
- updated_at
```

### Modified Tables

#### `license_keys` Table (added fields)
```sql
- price (decimal 10,2) - stores the actual price paid
- reseller_id (foreign key) - links to reseller who generated it
```

## üîê User Access Levels

### 1. **Admin**
- Full system access
- Can manage members, resellers, and licenses
- Can set pricing for license durations
- Login: `/admin/login`

### 2. **Reseller**
- Can generate license keys (if sufficient balance)
- Can view their own licenses and usage statistics
- Cannot modify prices or manage other resellers
- Login: `/reseller/login`

### 3. **Member (Desktop App Users)**
- Can redeem license keys via API
- Machine ID locked for security
- Access via desktop application

## üìã Admin Dashboard Features

### New Tabs Added

#### 1. **Resellers Tab**
- View all resellers with their balance and discount
- Create new resellers
- Edit reseller details (name, email, balance, discount)
- Add balance to reseller accounts
- Delete resellers
- See total licenses generated by each reseller

#### 2. **License Pricing Tab**
- Set base price for each license duration
- Real-time price updates
- Prices apply to all future license generations

### Reseller Management

**Create Reseller:**
1. Go to Admin Dashboard ‚Üí Resellers tab
2. Click "+ Add Reseller"
3. Fill in:
   - Name
   - Email
   - Password
   - Initial Balance (Rp)
   - Discount Percentage (%)
4. Click Save

**Add Balance:**
1. Find reseller in list
2. Click "Add Balance"
3. Enter amount
4. Confirm

**Edit Reseller:**
1. Click "Edit" on reseller row
2. Modify details
3. Save changes

## üè™ Reseller Dashboard Features

### Overview Section
- Current Balance display
- Discount Rate display
- Total Licenses Generated count

### License Generation
- View pricing with discount applied
- Select duration (1, 3, 7, 14, or 30 days)
- Enter quantity (1-100)
- System checks balance before generation
- Automatic balance deduction

### License Management
- View all generated licenses
- See usage status (Available/Used)
- See which member redeemed the license
- One-click copy license code
- Filter and track license history

## üîå API Endpoints

### Reseller Authentication
```
POST /reseller/login
- email
- password
- remember (optional)
```

### License Generation (Reseller)
```
POST /reseller/licenses/generate
Headers: Authenticated reseller session
Body:
{
  "duration_days": 1|3|7|14|30,
  "quantity": 1-100
}

Response:
{
  "success": true,
  "licenses": [...],
  "total_cost": 36000,
  "remaining_balance": 964000
}
```

### Get Reseller Licenses
```
GET /reseller/licenses
Headers: Authenticated reseller session

Response:
{
  "success": true,
  "licenses": [...]
}
```

### Admin - Reseller Management
```
GET /admin/resellers - List all resellers
POST /admin/resellers - Create reseller
PUT /admin/resellers/{id} - Update reseller
DELETE /admin/resellers/{id} - Delete reseller
POST /admin/resellers/{id}/add-balance - Add balance
```

### Admin - Pricing Management
```
POST /admin/licenses/update-price
Body:
{
  "duration_days": 7,
  "price": 45000
}
```

## üöÄ Usage Workflows

### Workflow 1: Admin Creates Reseller
1. Admin logs in at `/admin/login`
2. Navigate to Resellers tab
3. Click "+ Add Reseller"
4. Set discount (e.g., 10%)
5. Add initial balance (e.g., Rp 1,000,000)
6. Reseller can now log in at `/reseller/login`

### Workflow 2: Reseller Generates Licenses
1. Reseller logs in at `/reseller/login`
2. View available balance and discount
3. Select license duration
4. Enter quantity
5. Click "Generate"
6. System deducts cost from balance
7. License keys are displayed
8. Copy keys to distribute to customers

### Workflow 3: Customer Redeems License
1. Customer receives license key from reseller
2. Customer logs into desktop app
3. App calls API: `POST /api/members/redeem-license`
4. License activates, expiry date is extended
5. License marked as "Used" in system

### Workflow 4: Admin Adjusts Pricing
1. Admin navigates to License Pricing tab
2. Update price for any duration
3. Click "Update Price"
4. New price applies immediately
5. Resellers see updated pricing with their discount

## üìä Calculation Examples

### Example 1: Reseller with 10% Discount
```
Base Price (7 days): Rp 40,000
Discount: 10%
Final Price: 40,000 √ó (100 - 10) / 100 = Rp 36,000

Quantity: 5 licenses
Total Cost: 36,000 √ó 5 = Rp 180,000
```

### Example 2: Reseller with 25% Discount
```
Base Price (30 days): Rp 139,000
Discount: 25%
Final Price: 139,000 √ó (100 - 25) / 100 = Rp 104,250

Quantity: 10 licenses
Total Cost: 104,250 √ó 10 = Rp 1,042,500
```

## üîí Security Features

1. **Separate Authentication Guards**
   - Admin: `auth` (web guard)
   - Reseller: `auth:reseller` (reseller guard)
   - Separate session management

2. **Balance Validation**
   - System checks balance before allowing generation
   - Atomic operations prevent negative balances

3. **Price Integrity**
   - Prices stored with each license key
   - Historical pricing preserved

4. **Access Control**
   - Resellers can only see their own data
   - Admins have full system access

## üéØ Default Credentials

### Admin (already seeded)
- Email: `admin@livekenceng.com`
- Password: `admin123`

### Test Reseller (create manually)
- Use admin dashboard to create test reseller
- Set initial balance: Rp 1,000,000
- Set discount: 10%

## üìà Business Benefits

1. **Scalable Distribution**: Resellers can generate licenses independently
2. **Flexible Pricing**: Different discount levels for different resellers
3. **Revenue Tracking**: Track which reseller generates what revenue
4. **Automated Billing**: Balance system prevents overspending
5. **Partner Management**: Easy onboarding and management of resellers

## üõ†Ô∏è Technical Stack

- **Backend**: Laravel 11
- **Authentication**: Multi-guard (web, reseller)
- **Database**: SQLite (easily switchable to MySQL/PostgreSQL)
- **Frontend**: Tailwind CSS
- **JavaScript**: Vanilla JS with Fetch API

## üìù Notes

- All monetary values are in Indonesian Rupiah (IDR)
- Prices are stored as decimals with 2 decimal places
- Balance deductions are atomic and transaction-safe
- License codes follow format: `LK-XXXX-XXXX-XXXX`

---

## üöÄ Getting Started

1. **Start the server:**
   ```bash
   php artisan serve
   ```

2. **Access the application:**
   - Homepage: http://localhost:8000
   - Admin: http://localhost:8000/admin/login
   - Reseller: http://localhost:8000/reseller/login

3. **Create your first reseller:**
   - Login as admin
   - Go to Resellers tab
   - Click "+ Add Reseller"
   - Fill in details and save

4. **Test license generation:**
   - Login as reseller
   - Generate a test license
   - Verify balance deduction

**The reseller system is now fully operational! üéâ**

